/*! d4 - v0.1.0
 *  License: MIT Expat
 *  Date: 2014-02-12
 */
(function(){"use strict";var t=this,n={},e=function(t){return t instanceof e?t:this instanceof e?(this.d4Wrapped=t,void 0):new e(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.d4=e):t.d4=e,e.features={},e.parsers={};var r=e.each=e.forEach=function(t,e,r){var s,i,a=Array.prototype.forEach;if(null!==t)if(a&&t.forEach===a)t.forEach(e,r);else if(t.length===+t.length){for(s=0,i=t.length;i>s;s++)if(e.call(r,t[s],s,t)===n)return}else{var u=d3.keys(t);for(s=0,i=u.length;i>s;s++)if(e.call(r,t[u[s]],u[s],t)===n)return}},s=function(t){throw Error("[d4] "+t)},i=function(t){return this.builder||(this.builder=t.bind(this)()),this},a=function(t,n){n||s("no builder defined");var r=e.merge({width:400,height:400,features:{},mixins:[],margin:{top:0,right:0,bottom:0,left:0}},t);return i.bind(r)(n),r.accessors=["margin","width","height","x","y"].concat(t.accessors||[]),r},u=function(t){this.builder?(this.builder.configure(t),this.builder.render(t)):s("no builder defined")},c=function(t,n){this.svg=d3.select(t).selectAll("svg").data([n]),this.featuresGroup=this.svg.enter().append("svg").append("g").attr("class","featuresGroup").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.svg.attr("width",this.width).attr("height",this.height).attr("class","d4"),this.svg.append("defs")},o=function(t){return function(n){n.each(function(n){c.bind(t,this)(n),u.bind(t)(n)})}};e.mixin=function(t,n){var r=d3.keys(t)[0];t[r]=t[r](r),e.extend(this.features,t),n!==void 0?(n=Math.max(Math.min(n,this.mixins.length-1),0),this.mixins.splice(n,0,r)):this.mixins.push(r);var s=this.features[r].accessors;s&&d3.keys(s).forEach(function(t){this.features[r][t]=function(n){return arguments.length?(this.features[r].accessors[t]=n,this.features[r]):this.features[r].accessors[t]}.bind(this)},this)},e.mixout=function(t){delete this.features[t],this.mixins=this.mixins.filter(function(n){return n!==t})},e.using=function(t,n){var e=this.features[t];e?n.bind(this)(e):s('Could not find feature: "'+t+'"')},e.baseChart=function(t,n){var r=a(t,n),s=o(r);return s.accessors=r.accessors,s.accessors.forEach(function(t){s[t]=function(n){return arguments.length?(r[t]=n,s):r[t]}}),s.using=function(t,n){return e.using.bind(r)(t,n),s},s.mixin=function(t,n){return e.mixin.bind(r)(t,n),s},s.mixout=function(t,n){return e.mixout.bind(r)(t,n),s},s.builder=function(t){return t.bind(s)(r),s},s.svg=function(t){return t(r.svg),s},s},e.merge=function(t,n){return e.extend(e.extend({},t),n)},e.extend=function(t){return r(Array.prototype.slice.call(arguments,1),function(n){if(n)for(var e in n)t[e]=n[e]}),t}}).call(this),function(){"use strict";var t=function(){var t=function(t){this.parent.x||(this.parent.xRoundBands=this.parent.xRoundBands||.3,this.parent.x=d3.scale.ordinal().domain(t.map(function(t){return t[0]})).rangeRoundBands([0,this.parent.width-this.parent.margin.left-this.parent.margin.right],this.parent.xRoundBands))},n=function(t){this.parent.y||(this.parent.y=d3.scale.linear().domain(d3.extent(t,function(t){return t[1]}))),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0]).clamp(!0).nice()},e=function(e){t.bind(this)(e),n.bind(this)(e)},r={configure:function(t){e.bind(this)(t)},render:function(t){var n=this.parent;n.mixins.forEach(function(e){n.features[e].render.bind(n)(n.features[e],t)})}};return r.parent=this,r};d4.columnChart=function(){var n=d4.baseChart({},t);return[{bars:d4.features.columnSeries},{barLabels:d4.features.columnLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){n.mixin(t)}),n}}.call(this),function(){"use strict";var t=function(){return 1},n=function(){var t=function(t){this.parent.x||(this.parent.xRoundBands=this.parent.xRoundBands||.3,this.parent.x=d3.scale.ordinal().domain(t.map(function(t){return t.x})).rangeRoundBands([0,this.parent.width-this.parent.margin.left-this.parent.margin.right],this.parent.xRoundBands))},n=function(t){this.parent.y||(this.parent.y=d3.scale.linear().domain(d3.extent(t,function(t){return t[this.yKey()]}))),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0]).clamp(!0).nice()},e=function(e){t.bind(this)(e),n.bind(this)(e)},r={configure:function(t){e.bind(this)(t)},render:function(t){var n=this.parent;n.mixins.forEach(function(e){n.features[e].render.bind(n)(n.features[e],t)})}};return r.parent=this,r};d4.groupedColumnChart=function(){var e=d4.baseChart({accessors:["groupsOf"],groupsOf:t},n);return[{bars:d4.features.groupedColumnSeries},{columnLabels:d4.features.groupedColumnLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){e.mixin(t)}),e}}.call(this),function(){"use strict";var t=function(){var t=function(t,n){var e=[];return t.map(function(t){return t.values.map(function(t){e.push(t[n])})}),d3.extent(e)},n=function(n){this.parent.x||(this.parent.x=d3.time.scale(this.parent.x).domain(t(n,0)).nice().clamp(!0)),this.parent.x.range([0,this.parent.width-this.parent.margin.left-this.parent.margin.right])},e=function(n){this.parent.y||(this.parent.y=d3.scale.linear().domain(t(n,1))),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0])},r=function(t){n.bind(this)(t),e.bind(this)(t)},s={configure:function(t){r.bind(this)(t)},render:function(t){var n=this.parent;n.mixins.forEach(function(e){n.features[e].render.bind(n)(n.features[e],t)})}};return s.parent=this,s};d4.lineChart=function(){var n=d4.baseChart({},t);return[{linesSeries:d4.features.lineSeries},{linesSeriesLabels:d4.features.lineSeriesLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){n.mixin(t)}),n}}.call(this),function(){"use strict";var t=function(){var t=function(t){this.parent.x||(this.parent.x=d3.scale.linear().domain(d3.extent(t,function(t){return t[0]}))),this.parent.x.range([0,this.parent.width-this.parent.margin.right-this.parent.margin.left]).clamp(!0).nice()},n=function(t){this.parent.y||(this.parent.yRoundBands=this.parent.yRoundBands||.3,this.parent.y=d3.scale.ordinal().domain(t.map(function(t){return t[1]})).rangeRoundBands([0,this.parent.height-this.parent.margin.top-this.parent.margin.bottom],this.parent.yRoundBands))},e=function(e){t.bind(this)(e),n.bind(this)(e)},r={configure:function(t){e.bind(this)(t)},render:function(t){var n=this.parent;n.mixins.forEach(function(e){n.features[e].render.bind(n)(n.features[e],t)})}};return r.parent=this,r};d4.rowChart=function(){var n=d4.baseChart({},t);return[{bars:d4.features.rowSeries},{rowLabels:d4.features.rowLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){n.mixin(t)}),n}}.call(this),function(){"use strict";var t=function(){var t=function(t){this.parent.x||d3.scale.linear().domain(t.map(function(t){return t[0]})).nice().clamp(!0),this.parent.x.range([0,this.parent.width-this.parent.margin.left-this.parent.margin.right])},n=function(t){this.parent.y||(this.parent.y=d3.scale.linear().domain(t.map(function(t){return t[1]})).nice().clamp(!0)),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0])},e=function(t){this.parent.z||(this.parent.z=d3.scale.linear().domain(t.map(function(t){return t[2]})).nice().clamp(!0));var n=this.parent.height-this.parent.margin.top-this.parent.margin.bottom;this.parent.z.range([n/t.length,n/(5*t.length)])},r=function(r){t.bind(this)(r),n.bind(this)(r),e.bind(this)(r)},s={configure:function(t){r.bind(this)(t)},render:function(t){var n=this.parent;n.mixins.forEach(function(e){n.features[e].render.bind(n)(n.features[e],t)})}};return s.parent=this,s};d4.scatterPlot=function(){var n=d4.baseChart({accessors:["z"]},t);return[{scatterSeries:d4.features.scatterSeries},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){n.mixin(t)}),n}}.call(this),function(){"use strict";var t=function(){var t=function(t){this.parent.x||(this.parent.xRoundBands=this.parent.xRoundBands||.3,this.parent.x=d3.scale.ordinal().domain(t.map(function(t){return t.x})).rangeRoundBands([0,this.parent.width-this.parent.margin.left-this.parent.margin.right],this.parent.xRoundBands))},n=function(t){this.parent.y||(this.parent.y=d3.scale.linear().domain(d3.extent(t,function(t){return t[1]}))),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0]).clamp(!0).nice()},e=function(e){t.bind(this)(e),n.bind(this)(e)},r={configure:function(t){e.bind(this)(t)},render:function(t){var n=this.parent;n.mixins.forEach(function(e){n.features[e].render.bind(n)(n.features[e],t)})}};return r.parent=this,r};d4.stackedColumnChart=function(){var n=d4.baseChart({},t);return[{bars:d4.features.stackedColumnSeries},{columnLabels:d4.features.stackedColumnLabels},{connectors:d4.features.stackedColumnConnectors},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){n.mixin(t)}),n}}.call(this),function(){"use strict";var t=function(){var t=function(t){this.parent.x||(this.parent.xRoundBands=this.parent.xRoundBands||.3,this.parent.x=d3.scale.ordinal().domain(t.map(function(t){return t.x})).rangeRoundBands([0,this.parent.width-this.parent.margin.left-this.parent.margin.right],this.parent.xRoundBands))},n=function(t){this.parent.y||(this.parent.y=d3.scale.linear().domain(d3.extent(t,function(t){return t[1]})),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0]).clamp(!0).nice())},e=function(e){t.bind(this)(e),n.bind(this)(e)},r={configure:function(t){e.bind(this)(t)},render:function(t){var n=this.parent;n.mixins.forEach(function(e){n.features[e].render.bind(n)(n.features[e],t)})}};return r.parent=this,r};d4.waterfallChart=function(){var n=d4.baseChart({},t);return[{bars:d4.features.stackedColumnSeries},{connectors:d4.features.waterfallConnectors},{columnLabels:d4.features.stackedColumnLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){n.mixin(t)}),n}}.call(this),function(){"use strict";d4.features.arrow=function(t){return{accessors:{tipSize:function(){return 6},x1:function(){return this.x(0)},x2:function(){return this.x(this.width-this.margin.left-this.margin.right)},y1:function(){return this.y(0)},y2:function(){return this.y(this.height-this.margin.top-this.margin.bottom)}},render:function(n){var e=this.svg.select("defs");e.append("marker").attr("id",t+"-end").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",n.accessors.tipSize.bind(this)).attr("markerHeight",n.accessors.tipSize.bind(this)).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),e.append("marker").attr("id",t+"-start").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",-n.accessors.tipSize.bind(this)()).attr("markerHeight",n.accessors.tipSize.bind(this)).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).append("line").attr("class","line").attr("x1",n.accessors.x1.bind(this)).attr("x2",n.accessors.x2.bind(this)).attr("y1",n.accessors.y1.bind(this)).attr("y2",n.accessors.y2.bind(this)).attr("marker-end","url(#"+t+"-end)");return r}}}}.call(this),function(){"use strict";d4.features.columnLabels=function(t){return{accessors:{x:function(t){return this.x(t[0])+this.x.rangeBand()/2},y:function(t){return 0>t[1]?this.y(t[1])+10:this.y(t[1])-5},text:function(t){return d3.format("").call(this,t[1])}},render:function(n,e){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(e);return r.enter().append("text"),r.exit().remove(),r.attr("class","column-label").text(n.accessors.text.bind(this)).attr("x",n.accessors.x.bind(this)).attr("y",n.accessors.y.bind(this)),r}}}}.call(this),function(){"use strict";d4.features.columnSeries=function(t){var n=function(t){return t instanceof Array},e=function(t){return n(t)&&n(t[0])&&n(t[0][1])?t:[t]};return{accessors:{x:function(t){return this.x(t[0])},y:function(t){return 0>t[1]?this.y(0):this.y(t[1])},width:function(){return this.x.rangeBand()},height:function(t){return Math.abs(this.y(t[1])-this.y(0))},classes:function(t,n){return 0>t[1]?"bar negative fill series"+n:"bar positive fill series"+n}},render:function(n,r){e(r),this.featuresGroup.append("g").attr("class",t);var s=this.svg.select("."+t).selectAll("."+t+"Series").data(r);s.enter().append("g"),s.exit().remove(),s.attr("class",function(t,n){return"series"+n});var i=s.selectAll("rect").data(function(t){return[t]});return i.enter().append("rect"),i.exit().remove(),i.attr("class",n.accessors.classes.bind(this)).attr("x",n.accessors.x.bind(this)).attr("y",n.accessors.y.bind(this)).attr("width",n.accessors.width.bind(this)).attr("height",n.accessors.height.bind(this)),i}}}}.call(this),function(){"use strict";d4.features.grid=function(t){return{accessors:{formatXAxis:function(t){return t.orient("bottom")},formatYAxis:function(t){return t.orient("left")}},render:function(n){var e=d3.svg.axis().scale(this.x),r=d3.svg.axis().scale(this.y),s=n.accessors.formatXAxis.bind(this)(e),i=n.accessors.formatYAxis.bind(this)(r);this.featuresGroup.append("g").attr("class","grid border "+t).attr("transform","translate(0,0)").append("rect").attr("x",0).attr("y",0).attr("width",this.width-this.margin.left-this.margin.right).attr("height",this.height-this.margin.top-this.margin.bottom),this.featuresGroup.append("g").attr("class","x grid "+t).attr("transform","translate(0,"+(this.height-this.margin.top-this.margin.bottom)+")").call(s.tickSize(-(this.height-this.margin.top-this.margin.bottom),0,0).tickFormat("")),this.featuresGroup.append("g").attr("class","y grid "+t).attr("transform","translate(0,0)").call(i.tickSize(-(this.width-this.margin.left-this.margin.right),0,0).tickFormat(""))}}}}.call(this),function(){"use strict";d4.features.groupedColumnLabels=function(t){return{accessors:{x:function(t,n){var e=this.x.rangeBand()/this.groupsOf,r=this.x(t[this.xKey()])+e*n,s=.1*e;return r+e/2-s},y:function(t){return(0>t[this.yKey()]?this.y(0):this.y(t[this.yKey()]))-5},text:function(t){return d3.format("").call(this,t[this.yKey()])}},render:function(n,e){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll(".group").data(e).enter().append("g").attr("class",function(t,n){return"series"+n+" "+this.xKey()}.bind(this)),s=r.selectAll("text").data(function(t){return t.values}.bind(this));s.exit().remove(),s.enter().append("text").text(n.accessors.text.bind(this)).attr("y",n.accessors.y.bind(this)).attr("x",n.accessors.x.bind(this))}}}}.call(this),function(){"use strict";d4.features.groupedColumnSeries=function(t){var n=function(t){return t>0?"positive":"negative"};return{accessors:{x:function(t,n){var e=this.x.rangeBand()/this.groupsOf,r=this.x(t[this.xKey()])+e*n;return r},y:function(t){return 0>t[this.yKey()]?this.y(0):this.y(t[this.yKey()])},width:function(){var t=this.x.rangeBand()/this.groupsOf,n=.1*t;return t-n},height:function(t){return Math.abs(this.y(t[this.yKey()])-this.y(0))},classes:function(t,e){return"bar fill item"+e+" "+n(t[this.yKey()])+" "+t[this.yKey()]}},render:function(n,e){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll(".group").data(e).enter().append("g").attr("class",function(t,n){return"series"+n+" "+this.xKey()}.bind(this));r.selectAll("rect").data(function(t){return t.values}.bind(this)).enter().append("rect").attr("class",n.accessors.classes.bind(this)).attr("x",n.accessors.x.bind(this)).attr("y",n.accessors.y.bind(this)).attr("width",n.accessors.width.bind(this)).attr("height",n.accessors.height.bind(this))}}}}.call(this),function(){"use strict";d4.features.lineSeriesLabels=function(t){return{accessors:{x:function(t){return this.x(t.values[t.values.length-1][0])},y:function(t){return this.y(t.values[t.values.length-1][1])},text:function(t){return t.name},classes:function(t,n){return"stroke series"+n}},render:function(n,e){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(e);return r.enter().append("text"),r.exit().remove(),r.attr("class","lineSeriesLabel").text(n.accessors.text.bind(this)).attr("x",n.accessors.x.bind(this)).attr("y",n.accessors.y.bind(this)).attr("class",n.accessors.classes.bind(this)),r}}}}.call(this),function(){"use strict";d4.features.lineSeries=function(t){return{accessors:{x:function(t){return this.x(t[0])},y:function(t){return this.y(t[1])},classes:function(t,n){return"line stroke series"+n}},render:function(n,e){this.featuresGroup.append("g").attr("class",t);var r=d3.svg.line().x(n.accessors.x.bind(this)).y(n.accessors.y.bind(this)),s=this.svg.select("."+t).selectAll("."+t).data(e).enter().append("path").attr("d",function(t){return r(t.values)}).attr("class",n.accessors.classes.bind(this));return s}}}}.call(this),function(){"use strict";d4.features.referenceLine=function(t){return{accessors:{x1:function(){return this.x(0)},x2:function(){return this.x(this.width-this.margin.left-this.margin.right)},y1:function(){return this.y(0)},y2:function(){return this.y(this.height)}},render:function(n){this.featuresGroup.append("g").attr("class",t);var e=this.svg.select("."+t).append("line").attr("class","line").attr("x1",n.accessors.x1.bind(this)).attr("x2",n.accessors.x2.bind(this)).attr("y1",n.accessors.y1.bind(this)).attr("y2",n.accessors.y2.bind(this));return e}}}}.call(this),function(){"use strict";d4.features.rowLabels=function(t){return{accessors:{x:function(t){return this.x(Math.min(0,t[0]))+Math.abs(this.x(t[0])-this.x(0))+5},y:function(t){return this.y(t[1])+this.y.rangeBand()/2},text:function(t){return d3.format("").call(this,t[0])}},render:function(n,e){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(e);return r.enter().append("text"),r.exit().remove(),r.attr("class","column-label").text(n.accessors.text.bind(this)).attr("x",n.accessors.x.bind(this)).attr("y",n.accessors.y.bind(this)),r}}}}.call(this),function(){"use strict";d4.features.rowSeries=function(t){return{accessors:{x:function(t){return this.x(Math.min(0,t[0]))},y:function(t){return this.y(t[1])},height:function(){return this.y.rangeBand()},width:function(t){return Math.abs(this.x(t[0])-this.x(0))},classes:function(t,n){return 0>t[0]?"bar negative fill series"+n:"bar positive fill series"+n}},render:function(n,e){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(e);return r.enter().append("rect"),r.exit().remove(),r.attr("class",n.accessors.classes.bind(this)).attr("x",n.accessors.x.bind(this)).attr("y",n.accessors.y.bind(this)).attr("width",n.accessors.width.bind(this)).attr("height",n.accessors.height.bind(this)),this.featuresGroup.append("g").attr("class","x zero "+t).append("line").attr("class","line").attr("x1",this.x(0)).attr("x2",this.x(0)).attr("y1",0).attr("y2",this.height),r}}}}.call(this),function(){"use strict";d4.features.scatterSeries=function(t){return{accessors:{cx:function(t){return this.x(t.values[0])},cy:function(t){return this.y(t.values[1])},r:function(t){return this.z(t.values[2])},classes:function(t,n){return"dot series"+n+" fill"}},render:function(n,e){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(e);return r.enter().append("circle"),r.attr("class",n.accessors.classes.bind(this)).attr("r",n.accessors.r.bind(this)).attr("cx",n.accessors.cx.bind(this)).attr("cy",n.accessors.cy.bind(this)),r}}}}.call(this),function(){"use strict";d4.features.stackedColumnConnectors=function(t){return{accessors:{x1:function(t){var n=0,e=t.y0+t.y-Math.max(0,t.y);return t.y>0&&(n=Math.abs(this.x(t.y0)-this.x(t.y0+t.y))),this.x(e)+n},y1:function(t){return this.y(t[this.yKey()])},span:function(){return this.y.rangeBand()},classes:function(t,n){return"series"+n}},render:function(n){this.featuresGroup.append("g").attr("class",t);var e=this.svg.select("."+t).selectAll("."+t).data(function(t){return t.map(function(t){return t.values[0]})}.bind(this));return e.enter().append("line"),e.exit().remove(),e.attr("class",n.accessors.classes.bind(this)).attr("x1",function(){}.bind(this)).attr("y1",function(){}.bind(this)).attr("x2",function(){}.bind(this)).attr("y2",function(){}.bind(this)),e}}}}.call(this),function(){"use strict";d4.features.stackedColumnLabels=function(t){var n=function(t){return t>0?"positive":"negative"};return{accessors:{x:function(t){return this.x(t[this.xKey()])+this.x.rangeBand()/2},y:function(t){var n=Math.abs(this.y(t.y0)-this.y(t.y0+t.y))/2,e=t.y0+t.y;return 0>e?this.y(t.y0)-n:this.y(e)+n},text:function(t){return d3.format("").call(this,t.value)}},render:function(e,r){this.featuresGroup.append("g").attr("class",t);var s=this.svg.select("."+t).selectAll(".group").data(r).enter().append("g").attr("class",function(t,e){return"series"+e+" "+n(t.y)+" "+this.xKey()}.bind(this)),i=s.selectAll("text").data(function(t){return t.values}.bind(this));i.exit().remove(),i.enter().append("text").text(e.accessors.text.bind(this)).attr("y",e.accessors.y.bind(this)).attr("x",e.accessors.x.bind(this))}}}}.call(this),function(){"use strict";d4.features.stackedColumnSeries=function(t){var n=function(t){return t>0?"positive":"negative"};return{accessors:{x:function(t){return this.x(t[this.xKey()])},y:function(t){var n=t.y0+t.y;return 0>n?this.y(t.y0):this.y(n)},width:function(){return this.x.rangeBand()},height:function(t){return Math.abs(this.y(t.y0)-this.y(t.y0+t.y))},classes:function(t,e){return"bar fill item"+e+" "+n(t.y)+" "+t[this.yKey()]}},render:function(n,e){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll(".group").data(e).enter().append("g").attr("class",function(t,n){return"series"+n+" "+this.xKey()}.bind(this));r.selectAll("rect").data(function(t){return t.values}.bind(this)).enter().append("rect").attr("class",n.accessors.classes.bind(this)).attr("x",n.accessors.x.bind(this)).attr("y",n.accessors.y.bind(this)).attr("width",n.accessors.width.bind(this)).attr("height",n.accessors.height.bind(this))}}}}.call(this),function(){"use strict";d4.features.trendLine=function(t){return{accessors:{x1:function(){return this.x(0)},x2:function(){return this.x(this.width)},y1:function(){return this.y(0)},y2:function(){return this.y(this.height)},text:function(t){return d3.format("").call(this,t[1])},textX:function(){return this.x(this.width)},textY:function(){return this.x(this.height)}},render:function(n){var e=this.svg.select("defs");e.append("marker").attr("id",t+"-start").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",-6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).append("line").attr("class","line").attr("x1",n.accessors.x1.bind(this)).attr("x2",n.accessors.x2.bind(this)).attr("y1",n.accessors.y1.bind(this)).attr("y2",n.accessors.y2.bind(this)).attr("marker-end","url(#"+t+"-start)");return this.svg.select("."+t).append("text").attr("class","trendLine-label").text(n.accessors.text.bind(this)).attr("x",n.accessors.textX.bind(this)).attr("y",n.accessors.textY.bind(this)),r}}}}.call(this),function(){"use strict";d4.features.waterfallConnectors=function(t){return{accessors:{x1:function(t){var n=0,e=t.y0+t.y-Math.max(0,t.y);return t.y>0&&(n=Math.abs(this.x(t.y0)-this.x(t.y0+t.y))),this.x(e)+n},y1:function(t){return this.y(t[this.yKey()])},span:function(){return this.y.rangeBand()},classes:function(t,n){return"series"+n}},render:function(n,e){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(function(t){return t.map(function(t){return t.values[0]})}.bind(this));return r.enter().append("line"),r.exit().remove(),r.attr("class",n.accessors.classes.bind(this)).attr("x1",function(t,r){return 0===r?0:n.accessors.x1.bind(this)(e[r-1].values[0])}.bind(this)).attr("y1",function(t,r){return 0===r?0:n.accessors.y1.bind(this)(e[r-1].values[0])}.bind(this)).attr("x2",function(t,r){return 0===r?0:n.accessors.x1.bind(this)(e[r-1].values[0])}.bind(this)).attr("y2",function(t,e){return 0===e?0:n.accessors.y1.bind(this)(t)+n.accessors.span.bind(this)(t)}.bind(this)),r}}}}.call(this),function(){"use strict";d4.features.xAxis=function(t){return{accessors:{format:function(t){return t.orient("bottom").tickSize(0)}},render:function(n){var e=d3.svg.axis().scale(this.x),r=n.accessors.format.bind(this)(e);this.featuresGroup.append("g").attr("class","x axis "+t).attr("transform","translate(0,"+(this.height-this.margin.top-this.margin.bottom)+")").call(r)}}}}.call(this),function(){"use strict";d4.features.yAxis=function(t){var n=function(t,n){t.each(function(){var t,e=d3.select(this),r=e.text().split(/\s+/).reverse(),s=[],i=0,a=1.1,u=e.attr("x"),c=e.attr("y"),o=parseFloat(e.attr("dy")),h=e.text(null).append("tspan").attr("x",u).attr("y",c).attr("dy",o+"em");for(t=r.pop();t;)s.push(t),h.text(s.join(" ")),h.node().getComputedTextLength()>n-Math.abs(u)&&(s.pop(),h.text(s.join(" ")),s=[t],h=e.append("tspan").attr("x",u).attr("y",c).attr("dy",++i*a+o+"em").text(t)),t=r.pop()})};return{accessors:{format:function(t){return t.orient("left").tickSize(0)}},render:function(e){var r=d3.svg.axis().scale(this.y),s=e.accessors.format.bind(this)(r);this.featuresGroup.append("g").attr("class","y axis "+t).attr("transform","translate(0,0)").call(s).selectAll(".tick text").call(n,this.margin.left)}}}}.call(this),function(){"use strict";d4.parsers.nestedGroup=function(){var t={x:{key:"x",values:[]},y:{key:"y",values:[]},value:{key:"value",values:[]},data:[]},n=function(n,e){["x","y","value"].forEach(function(r){var s=e.map(function(t){return t[n[r].key]});t[r].values=d3.set(s).values()})},e=function(t,n,e){var r=d3.nest().key(function(n){return n[t]});return r.entries(e)},r=function(n,e){t[n].key=e()},s=function(r){return r&&d4.extend(t.data,r),n(t,t.data),t.data=e(t.x.key,t.value.key,t.data),t};return s.x=function(n){return r.bind(t)("x",n),s},s.y=function(n){return r.bind(t)("y",n),s},s.value=function(n){return r.bind(t)("value",n),s},s}}.call(this),function(){"use strict";d4.parsers.nestedStack=function(){var t={x:{key:"x",values:[]},y:{key:"y",values:[]},value:{key:"value",values:[]},data:[]},n=function(n,e){["x","y","value"].forEach(function(r){var s=e.map(function(t){return t[n[r].key]});t[r].values=d3.set(s).values()})},e=function(t,n,e){var r=d3.nest().key(function(n){return n[t]});return r.entries(e)},r=function(n,e){var r={},s=d3.layout.stack().values(function(t){return t.values}).x(function(t){return t[n]}).y(function(n){return+n[t.value.key]}).out(function(t,e,s){t.y=s,t.y>=0?(t.y0=r[t[n]+"Pos"]=r[t[n]+"Pos"]||0,r[t[n]+"Pos"]+=s):(t.y0=r[t[n]+"Neg"]=r[t[n]+"Neg"]||0,r[t[n]+"Neg"]-=Math.abs(s))});s(e.reverse())},s=function(n,e){t[n].key=e()},i=function(s){return s&&d4.extend(t.data,s),n(t,t.data),t.data=e(t.y.key,t.value.key,t.data),r(t.x.key,t.data),t};return i.x=function(n){return s.bind(t)("x",n),i},i.y=function(n){return s.bind(t)("y",n),i},i.value=function(n){return s.bind(t)("value",n),i},i}}.call(this),function(){"use strict";d4.parsers.waterfall=function(){var t={x:{key:"x",values:[]},y:{key:"y",values:[]},value:{key:"value",values:[]},data:[]},n=function(n,e){["x","y","value"].forEach(function(r){var s=e.map(function(t){return t[n[r].key]});t[r].values=d3.set(s).values()})},e=function(t,n,e){var r=d3.nest().key(function(n){return n[t]});return r.entries(e)},r=function(n,e){var r=0,s=function(t){return isNaN(t)?0:t},i=d3.layout.stack().values(function(t){return t.values}).x(function(t){return t[n]}).y(function(n){return+n[t.value.key]}).out(function(n,e,i){isNaN(i)?(isNaN(e)&&(e=r),n.y0=0,n.y=e,n[t.value.key]=e,r=e):(isNaN(e)?(n.y0=r,r+=i):n.y0=e,n.y=i,n[t.value.key]=s(n[t.value.key]))});i(e)},s=function(n,e){t[n].key=e()},i=function(s){return s&&d4.extend(t.data,s),n(t,t.data),t.data=e(t.y.key,t.value.key,t.data),r(t.x.key,t.data),t};return i.x=function(n){return s.bind(t)("x",n),i},i.y=function(n){return s.bind(t)("y",n),i},i.value=function(n){return s.bind(t)("value",n),i},i}}.call(this);