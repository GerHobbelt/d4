/*! d4 - v0.1.0
 *  License: MIT Expat
 *  Date: 2014-02-02
 */
(function(){"use strict";var t=this,e={},r=function(t){return t instanceof r?t:this instanceof r?(this.d4Wrapped=t,void 0):new r(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=r),exports.d4=r):t.d4=r,r.VERSION=.5,r.features={},r.parsers={};var n=r.each=r.forEach=function(t,n,s){var i,a,c=Array.prototype.forEach;if(null!==t)if(c&&t.forEach===c)t.forEach(n,s);else if(t.length===+t.length){for(i=0,a=t.length;a>i;i++)if(n.call(s,t[i],i,t)===e)return}else{var u=r.keys(t);for(i=0,a=u.length;a>i;i++)if(n.call(s,t[u[i]],u[i],t)===e)return}},s=function(t){throw Error("[d4] "+t)},i=function(t){return this.builder||(this.builder=t.bind(this)()),this},a=function(t,e){var n=r.merge({width:400,height:400,features:{},mixins:[],margin:{top:0,right:0,bottom:0,left:0}},t);return i.bind(n)(e),n.accessors=["margin","width","height","x","y"].concat(t.accessors||[]),n},c=function(t){this.builder?(this.builder.configure(t),this.builder.render(t)):r.assert("no builder defined")},u=function(t,e){this.svg=d3.select(t).selectAll("svg").data([e]),this.featuresGroup=this.svg.enter().append("svg").append("g").attr("class","featuresGroup").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.svg.attr("width",this.width).attr("height",this.height).attr("class","d4"),this.svg.append("defs")},o=function(t){return function(e){e.each(function(e){u.bind(t,this)(e),c.bind(t)(e)})}};r.mixin=function(t,e){var n=d3.keys(t)[0];t[n]=t[n](n),r.extend(this.features,t),e!==void 0?(e=Math.max(Math.min(e,this.mixins.length-1),0),this.mixins.splice(e,0,n)):this.mixins.push(n);var s=this.features[n].accessors;s&&d3.keys(s).forEach(function(t){this.features[n][t]=function(e){return arguments.length?(this.features[n].accessors[t]=e,this.features[n]):this.features[n].accessors[t]}.bind(this)},this)},r.mixout=function(t){delete this.features[t],this.mixins=this.mixins.filter(function(e){return e!==t})},r.using=function(t,e){var r=this.features[t];r?e.bind(this)(r):s('Could not find feature: "'+t+'"')},r.baseChart=function(t,e){var n=a(t,e),s=o(n);return s.accessors=n.accessors,s.accessors.forEach(function(t){s[t]=function(e){return arguments.length?(n[t]=e,s):n[t]}}),s.using=function(t,e){return r.using.bind(n)(t,e),s},s.mixin=function(t,e){return r.mixin.bind(n)(t,e),s},s.mixout=function(t,e){return r.mixout.bind(n)(t,e),s},s.builder=function(t){return t.bind(s)(n),s},s.svg=function(t){return t(n.svg),s},s},r.merge=function(t,e){return r.extend(r.extend({},t),e)},r.extend=function(t){return n(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var r in e)t[r]=e[r]}),t}}).call(this),function(){"use strict";var t=function(){var t=function(t){this.parent.x||(this.parent.xRoundBands=this.parent.xRoundBands||.3,this.parent.x=d3.scale.ordinal().domain(t.map(function(t){return t[0]})).rangeRoundBands([0,this.parent.width-this.parent.margin.left-this.parent.margin.right],this.parent.xRoundBands))},e=function(t){this.parent.y||(this.parent.y=d3.scale.linear().domain(d3.extent(t,function(t){return t[1]}))),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0]).clamp(!0).nice()},r=function(r){t.bind(this)(r),e.bind(this)(r)},n={configure:function(t){r.bind(this)(t)},render:function(t){var e=this.parent;e.mixins.forEach(function(r){e.features[r].render.bind(e)(e.features[r],t)})}};return n.parent=this,n};d4.columnChart=function(){var e=d4.baseChart({},t);return[{bars:d4.features.columnSeries},{barLabels:d4.features.columnLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){e.mixin(t)}),e}}.call(this),function(){"use strict";var t=function(){var t=function(t,e){var r=[];return t.map(function(t){return t.values.map(function(t){r.push(t[e])})}),d3.extent(r)},e=function(e){this.parent.x||(this.parent.x=d3.time.scale(this.parent.x).domain(t(e,0)).nice().clamp(!0)),this.parent.x.range([0,this.parent.width-this.parent.margin.left-this.parent.margin.right])},r=function(e){this.parent.y||(this.parent.y=d3.scale.linear().domain(t(e,1))),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0])},n=function(t){e.bind(this)(t),r.bind(this)(t)},s={configure:function(t){n.bind(this)(t)},render:function(t){var e=this.parent;e.mixins.forEach(function(r){e.features[r].render.bind(e)(e.features[r],t)})}};return s.parent=this,s};d4.lineChart=function(){var e=d4.baseChart({},t);return[{linesSeries:d4.features.lineSeries},{linesSeriesLabels:d4.features.lineSeriesLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){e.mixin(t)}),e}}.call(this),function(){"use strict";var t=function(){var t=function(t){this.parent.x||(this.parent.x=d3.scale.linear().domain(d3.extent(t,function(t){return t[0]}))),this.parent.x.range([0,this.parent.width-this.parent.margin.right-this.parent.margin.left]).clamp(!0).nice()},e=function(t){this.parent.y||(this.parent.yRoundBands=this.parent.yRoundBands||.3,this.parent.y=d3.scale.ordinal().domain(t.map(function(t){return t[1]})).rangeRoundBands([0,this.parent.height-this.parent.margin.top-this.parent.margin.bottom],this.parent.yRoundBands))},r=function(r){t.bind(this)(r),e.bind(this)(r)},n={configure:function(t){r.bind(this)(t)},render:function(t){var e=this.parent;e.mixins.forEach(function(r){e.features[r].render.bind(e)(e.features[r],t)})}};return n.parent=this,n};d4.rowChart=function(){var e=d4.baseChart({},t);return[{bars:d4.features.rowSeries},{rowLabels:d4.features.rowLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){e.mixin(t)}),e}}.call(this),function(){"use strict";var t=function(){var t=function(t){this.parent.x||d3.scale.linear().domain(t.map(function(t){return t[0]})).nice().clamp(!0),this.parent.x.range([0,this.parent.width-this.parent.margin.left-this.parent.margin.right])},e=function(t){this.parent.y||(this.parent.y=d3.scale.linear().domain(t.map(function(t){return t[1]})).nice().clamp(!0)),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0])},r=function(t){this.parent.z||(this.parent.z=d3.scale.linear().domain(t.map(function(t){return t[2]})).nice().clamp(!0));var e=this.parent.height-this.parent.margin.top-this.parent.margin.bottom;this.parent.z.range([e/t.length,e/(5*t.length)])},n=function(n){t.bind(this)(n),e.bind(this)(n),r.bind(this)(n)},s={configure:function(t){n.bind(this)(t)},render:function(t){var e=this.parent;e.mixins.forEach(function(r){e.features[r].render.bind(e)(e.features[r],t)})}};return s.parent=this,s};d4.scatterPlot=function(){var e=d4.baseChart({accessors:["z"]},t);return[{scatterSeries:d4.features.scatterSeries},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){e.mixin(t)}),e}}.call(this),function(){"use strict";var t=function(){return"x"},e=function(){return"y"},r=function(){var t=function(t){this.parent.x||(this.parent.xRoundBands=this.parent.xRoundBands||.3,this.parent.x=d3.scale.ordinal().domain(t.map(function(t){return t.x})).rangeRoundBands([0,this.parent.width-this.parent.margin.left-this.parent.margin.right],this.parent.xRoundBands))},e=function(t){this.parent.y||(this.parent.y=d3.scale.linear().domain(d3.extent(t,function(t){return t[1]}))),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0]).clamp(!0).nice()},r=function(r){t.bind(this)(r),e.bind(this)(r)},n={configure:function(t){r.bind(this)(t)},render:function(t){var e=this.parent;e.mixins.forEach(function(r){e.features[r].render.bind(e)(e.features[r],t)})}};return n.parent=this,n};d4.stackedColumnChart=function(){var n=d4.baseChart({accessors:["xKey","yKey"],xKey:t,yKey:e},r);return[{bars:d4.features.stackedColumnSeries},{columnLabels:d4.features.stackedColumnLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){n.mixin(t)}),n}}.call(this),function(){"use strict";d4.features.arrow=function(t){return{accessors:{tipSize:function(){return 6},x1:function(){return this.x(0)},x2:function(){return this.x(this.width-this.margin.left-this.margin.right)},y1:function(){return this.y(0)},y2:function(){return this.y(this.height-this.margin.top-this.margin.bottom)}},render:function(e){var r=this.svg.select("defs");r.append("marker").attr("id",t+"-end").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",e.accessors.tipSize.bind(this)).attr("markerHeight",e.accessors.tipSize.bind(this)).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),r.append("marker").attr("id",t+"-start").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",-e.accessors.tipSize.bind(this)()).attr("markerHeight",e.accessors.tipSize.bind(this)).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),this.featuresGroup.append("g").attr("class",t);var n=this.svg.select("."+t).append("line").attr("class","line").attr("x1",e.accessors.x1.bind(this)).attr("x2",e.accessors.x2.bind(this)).attr("y1",e.accessors.y1.bind(this)).attr("y2",e.accessors.y2.bind(this)).attr("marker-end","url(#"+t+"-end)");return n}}}}.call(this),function(){"use strict";d4.features.columnLabels=function(t){return{accessors:{x:function(t){return this.x(t[0])+this.x.rangeBand()/2},y:function(t){return 0>t[1]?this.y(t[1])+10:this.y(t[1])-5},text:function(t){return d3.format("").call(this,t[1])}},render:function(e,r){this.featuresGroup.append("g").attr("class",t);var n=this.svg.select("."+t).selectAll("."+t).data(r);return n.enter().append("text"),n.exit().remove(),n.attr("class","column-label").text(e.accessors.text.bind(this)).attr("x",e.accessors.x.bind(this)).attr("y",e.accessors.y.bind(this)),n}}}}.call(this),function(){"use strict";d4.features.columnSeries=function(t){var e=function(t){return t instanceof Array},r=function(t){return e(t)&&e(t[0])&&e(t[0][1])?t:[t]};return{accessors:{x:function(t){return this.x(t[0])},y:function(t){return 0>t[1]?this.y(0):this.y(t[1])},width:function(){return this.x.rangeBand()},height:function(t){return Math.abs(this.y(t[1])-this.y(0))}},render:function(e,n){r(n),this.featuresGroup.append("g").attr("class",t);var s=this.svg.select("."+t).selectAll("."+t+"Series").data(n);s.enter().append("g"),s.exit().remove(),s.attr("class",function(t,e){return"series"+e});var i=s.selectAll("rect").data(function(t){return[t]});return i.enter().append("rect"),i.exit().remove(),i.attr("class",function(t,e){return 0>t[1]?"bar negative fill series"+e:"bar positive fill series"+e}).attr("x",e.accessors.x.bind(this)).attr("y",e.accessors.y.bind(this)).attr("width",e.accessors.width.bind(this)).attr("height",e.accessors.height.bind(this)),i}}}}.call(this),function(){"use strict";d4.features.grid=function(t){return{accessors:{formatXAxis:function(t){return t.orient("bottom")},formatYAxis:function(t){return t.orient("left")},klass:function(t,e){return"stroke series"+e}},render:function(e){var r=d3.svg.axis().scale(this.x),n=d3.svg.axis().scale(this.y),s=e.accessors.formatXAxis.bind(this)(r),i=e.accessors.formatYAxis.bind(this)(n);this.featuresGroup.append("g").attr("class","grid border "+t).attr("transform","translate(0,0)").append("rect").attr("x",0).attr("y",0).attr("width",this.width-this.margin.left-this.margin.right).attr("height",this.height-this.margin.top-this.margin.bottom),this.featuresGroup.append("g").attr("class","x grid "+t).attr("transform","translate(0,"+(this.height-this.margin.top-this.margin.bottom)+")").call(s.tickSize(-(this.height-this.margin.top-this.margin.bottom),0,0).tickFormat("")),this.featuresGroup.append("g").attr("class","y grid "+t).attr("transform","translate(0,0)").call(i.tickSize(-(this.width-this.margin.left-this.margin.right),0,0).tickFormat(""))}}}}.call(this),function(){"use strict";d4.features.lineSeriesLabels=function(t){return{accessors:{x:function(t){return this.x(t.values[t.values.length-1][0])},y:function(t){return this.y(t.values[t.values.length-1][1])},text:function(t){return t.name},klass:function(t,e){return"stroke series"+e}},render:function(e,r){this.featuresGroup.append("g").attr("class",t);var n=this.svg.select("."+t).selectAll("."+t).data(r);return n.enter().append("text"),n.exit().remove(),n.attr("class","lineSeriesLabel").text(e.accessors.text.bind(this)).attr("x",e.accessors.x.bind(this)).attr("y",e.accessors.y.bind(this)).attr("class",e.accessors.klass.bind(this)),n}}}}.call(this),function(){"use strict";d4.features.lineSeries=function(t){return{accessors:{x:function(t){return this.x(t[0])},y:function(t){return this.y(t[1])}},render:function(e,r){this.featuresGroup.append("g").attr("class",t);var n=d3.svg.line().x(e.accessors.x.bind(this)).y(e.accessors.y.bind(this)),s=this.svg.select("."+t).selectAll("."+t).data(r).enter().append("path").attr("d",function(t){return n(t.values)}).attr("class",function(t,e){return"line stroke series"+e});return s}}}}.call(this),function(){"use strict";d4.features.referenceLine=function(t){return{accessors:{x1:function(){return this.x(0)},x2:function(){return this.x(this.width-this.margin.left-this.margin.right)},y1:function(){return this.y(0)},y2:function(){return this.y(this.height)}},render:function(e){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).append("line").attr("class","line").attr("x1",e.accessors.x1.bind(this)).attr("x2",e.accessors.x2.bind(this)).attr("y1",e.accessors.y1.bind(this)).attr("y2",e.accessors.y2.bind(this));return r}}}}.call(this),function(){"use strict";d4.features.rowLabels=function(t){return{accessors:{x:function(t){return this.x(Math.min(0,t[0]))+Math.abs(this.x(t[0])-this.x(0))+5},y:function(t){return this.y(t[1])+this.y.rangeBand()/2},text:function(t){return d3.format("").call(this,t[0])}},render:function(e,r){this.featuresGroup.append("g").attr("class",t);var n=this.svg.select("."+t).selectAll("."+t).data(r);return n.enter().append("text"),n.exit().remove(),n.attr("class","column-label").text(e.accessors.text.bind(this)).attr("x",e.accessors.x.bind(this)).attr("y",e.accessors.y.bind(this)),n}}}}.call(this),function(){"use strict";d4.features.rowSeries=function(t){return{accessors:{x:function(t){return this.x(Math.min(0,t[0]))},y:function(t){return this.y(t[1])},height:function(){return this.y.rangeBand()},width:function(t){return Math.abs(this.x(t[0])-this.x(0))}},render:function(e,r){this.featuresGroup.append("g").attr("class",t);var n=this.svg.select("."+t).selectAll("."+t).data(r);return n.enter().append("rect"),n.exit().remove(),n.attr("class",function(t,e){return 0>t[0]?"bar negative fill series"+e:"bar positive fill series"+e}).attr("x",e.accessors.x.bind(this)).attr("y",e.accessors.y.bind(this)).attr("width",e.accessors.width.bind(this)).attr("height",e.accessors.height.bind(this)),this.featuresGroup.append("g").attr("class","x zero "+t).append("line").attr("class","line").attr("x1",this.x(0)).attr("x2",this.x(0)).attr("y1",0).attr("y2",this.height),n}}}}.call(this),function(){"use strict";d4.features.scatterSeries=function(t){return{accessors:{cx:function(t){return this.x(t.values[0])},cy:function(t){return this.y(t.values[1])},r:function(t){return this.z(t.values[2])}},render:function(e,r){this.featuresGroup.append("g").attr("class",t);var n=this.svg.select("."+t).selectAll("."+t).data(r);return n.enter().append("circle"),n.attr("class",function(t,e){return"dot series"+e+" fill"}).attr("r",e.accessors.r.bind(this)).attr("cx",e.accessors.cx.bind(this)).attr("cy",e.accessors.cy.bind(this)),n}}}}.call(this),function(){"use strict";d4.features.stackedColumnLabels=function(t){return{accessors:{x:function(t){return this.x(t[this.xKey()])+this.x.rangeBand()/2},y:function(t){var e=Math.abs(this.y(t.y0)-this.y(t.y0+t.y))/2,r=t.y0+t.y;return 0>r?this.y(t.y0)-e:this.y(r)+e},text:function(t){return d3.format("").call(this,t.value)}},render:function(e,r){this.featuresGroup.append("g").attr("class",t);var n=this.svg.select("."+t).selectAll(".group").data(r).enter().append("g").attr("class",function(t,e){return"series"+e+" "+this.xKey()}.bind(this)),s=n.selectAll("text").data(function(t){return t.values}.bind(this));s.exit().remove(),s.enter().append("text").text(e.accessors.text.bind(this)).attr("y",e.accessors.y.bind(this)).attr("x",e.accessors.x.bind(this))}}}}.call(this),function(){"use strict";d4.features.stackedColumnSeries=function(t){return{accessors:{x:function(t){return this.x(t[this.xKey()])},y:function(t){var e=t.y0+t.y;return 0>e?this.y(t.y0):this.y(e)},width:function(){return this.x.rangeBand()},height:function(t){return Math.abs(this.y(t.y0)-this.y(t.y0+t.y))}},render:function(e,r){this.featuresGroup.append("g").attr("class",t);var n=this.svg.select("."+t).selectAll(".group").data(r).enter().append("g").attr("class",function(t,e){return"series"+e+" "+this.xKey()}.bind(this));n.selectAll("rect").data(function(t){return t.values}.bind(this)).enter().append("rect").attr("class",function(t,e){return"fill item"+e+" "+t[this.yKey()]}.bind(this)).attr("x",e.accessors.x.bind(this)).attr("y",e.accessors.y.bind(this)).attr("width",e.accessors.width.bind(this)).attr("height",e.accessors.height.bind(this))}}}}.call(this),function(){"use strict";d4.features.trendLine=function(t){return{accessors:{x1:function(){return this.x(0)},x2:function(){return this.x(this.width)},y1:function(){return this.y(0)},y2:function(){return this.y(this.height)},text:function(t){return d3.format("").call(this,t[1])},textX:function(){return this.x(this.width)},textY:function(){return this.x(this.height)}},render:function(e){var r=this.svg.select("defs");r.append("marker").attr("id",t+"-start").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",-6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),this.featuresGroup.append("g").attr("class",t);var n=this.svg.select("."+t).append("line").attr("class","line").attr("x1",e.accessors.x1.bind(this)).attr("x2",e.accessors.x2.bind(this)).attr("y1",e.accessors.y1.bind(this)).attr("y2",e.accessors.y2.bind(this)).attr("marker-end","url(#"+t+"-start)");return this.svg.select("."+t).append("text").attr("class","trendLine-label").text(e.accessors.text.bind(this)).attr("x",e.accessors.textX.bind(this)).attr("y",e.accessors.textY.bind(this)),n}}}}.call(this),function(){"use strict";d4.features.xAxis=function(t){return{accessors:{format:function(t){return t.orient("bottom").tickSize(0)}},render:function(e){var r=d3.svg.axis().scale(this.x),n=e.accessors.format.bind(this)(r);this.featuresGroup.append("g").attr("class","x axis "+t).attr("transform","translate(0,"+(this.height-this.margin.top-this.margin.bottom)+")").call(n)}}}}.call(this),function(){"use strict";d4.features.yAxis=function(t){return{accessors:{format:function(t){return t.orient("left").tickSize(0)}},render:function(e){var r=d3.svg.axis().scale(this.y),n=e.accessors.format.bind(this)(r);this.featuresGroup.append("g").attr("class","y axis "+t).attr("transform","translate(0,0)").call(n)}}}}.call(this),function(){"use strict";d4.parsers.nestedStack=function(){var t={x:{key:"x",values:[]},y:{key:"y",values:[]},value:{key:"value",values:[]},data:[]},e=function(e,r){["x","y","value"].forEach(function(n){var s=r.map(function(t){return t[e[n].key]});t[n].values=d3.set(s).values()})},r=function(t,e,r){var n=d3.nest().key(function(e){return e[t]});return n.entries(r)},n=function(e,r){var n={},s=d3.layout.stack().values(function(t){return t.values}).x(function(t){return t[e]}).y(function(e){return+e[t.value.key]}).out(function(t,r,s){t.y=s,t.y>=0?(t.y0=n[t[e]+"Pos"]=n[t[e]+"Pos"]||0,n[t[e]+"Pos"]+=s):(t.y0=n[t[e]+"Neg"]=n[t[e]+"Neg"]||0,n[t[e]+"Neg"]-=Math.abs(s))});s(r.reverse())},s=function(e,r){t[e].key=r()},i=function(s){return s&&d4.extend(t.data,s),e(t,t.data),t.data=r(t.y.key,t.value.key,t.data),n(t.x.key,t.data),t};return i.x=function(e){return s.bind(t)("x",e),i},i.y=function(e){return s.bind(t)("y",e),i},i.value=function(e){return s.bind(t)("value",e),i},i}}.call(this);