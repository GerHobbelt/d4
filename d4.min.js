/*! d4 - v0.1.0
 *  License: MIT Expat
 *  Date: 2014-02-04
 */
(function(){"use strict";var t=this,e={},n=function(t){return t instanceof n?t:this instanceof n?(this.d4Wrapped=t,void 0):new n(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.d4=n):t.d4=n,n.VERSION=.5,n.features={},n.parsers={};var r=n.each=n.forEach=function(t,n,r){var s,i,a=Array.prototype.forEach;if(null!==t)if(a&&t.forEach===a)t.forEach(n,r);else if(t.length===+t.length){for(s=0,i=t.length;i>s;s++)if(n.call(r,t[s],s,t)===e)return}else{var c=d3.keys(t);for(s=0,i=c.length;i>s;s++)if(n.call(r,t[c[s]],c[s],t)===e)return}},s=function(t){throw Error("[d4] "+t)},i=function(t){return this.builder||(this.builder=t.bind(this)()),this},a=function(t,e){var r=n.merge({width:400,height:400,features:{},mixins:[],margin:{top:0,right:0,bottom:0,left:0}},t);return i.bind(r)(e),r.accessors=["margin","width","height","x","y"].concat(t.accessors||[]),r},c=function(t){this.builder?(this.builder.configure(t),this.builder.render(t)):n.assert("no builder defined")},u=function(t,e){this.svg=d3.select(t).selectAll("svg").data([e]),this.featuresGroup=this.svg.enter().append("svg").append("g").attr("class","featuresGroup").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.svg.attr("width",this.width).attr("height",this.height).attr("class","d4"),this.svg.append("defs")},o=function(t){return function(e){e.each(function(e){u.bind(t,this)(e),c.bind(t)(e)})}};n.mixin=function(t,e){var r=d3.keys(t)[0];t[r]=t[r](r),n.extend(this.features,t),e!==void 0?(e=Math.max(Math.min(e,this.mixins.length-1),0),this.mixins.splice(e,0,r)):this.mixins.push(r);var s=this.features[r].accessors;s&&d3.keys(s).forEach(function(t){this.features[r][t]=function(e){return arguments.length?(this.features[r].accessors[t]=e,this.features[r]):this.features[r].accessors[t]}.bind(this)},this)},n.mixout=function(t){delete this.features[t],this.mixins=this.mixins.filter(function(e){return e!==t})},n.using=function(t,e){var n=this.features[t];n?e.bind(this)(n):s('Could not find feature: "'+t+'"')},n.baseChart=function(t,e){var r=a(t,e),s=o(r);return s.accessors=r.accessors,s.accessors.forEach(function(t){s[t]=function(e){return arguments.length?(r[t]=e,s):r[t]}}),s.using=function(t,e){return n.using.bind(r)(t,e),s},s.mixin=function(t,e){return n.mixin.bind(r)(t,e),s},s.mixout=function(t,e){return n.mixout.bind(r)(t,e),s},s.builder=function(t){return t.bind(s)(r),s},s.svg=function(t){return t(r.svg),s},s},n.merge=function(t,e){return n.extend(n.extend({},t),e)},n.extend=function(t){return r(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t}}).call(this),function(){"use strict";var t=function(){var t=function(t){this.parent.x||(this.parent.xRoundBands=this.parent.xRoundBands||.3,this.parent.x=d3.scale.ordinal().domain(t.map(function(t){return t[0]})).rangeRoundBands([0,this.parent.width-this.parent.margin.left-this.parent.margin.right],this.parent.xRoundBands))},e=function(t){this.parent.y||(this.parent.y=d3.scale.linear().domain(d3.extent(t,function(t){return t[1]}))),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0]).clamp(!0).nice()},n=function(n){t.bind(this)(n),e.bind(this)(n)},r={configure:function(t){n.bind(this)(t)},render:function(t){var e=this.parent;e.mixins.forEach(function(n){e.features[n].render.bind(e)(e.features[n],t)})}};return r.parent=this,r};d4.columnChart=function(){var e=d4.baseChart({},t);return[{bars:d4.features.columnSeries},{barLabels:d4.features.columnLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){e.mixin(t)}),e}}.call(this),function(){"use strict";var t=function(){var t=function(t,e){var n=[];return t.map(function(t){return t.values.map(function(t){n.push(t[e])})}),d3.extent(n)},e=function(e){this.parent.x||(this.parent.x=d3.time.scale(this.parent.x).domain(t(e,0)).nice().clamp(!0)),this.parent.x.range([0,this.parent.width-this.parent.margin.left-this.parent.margin.right])},n=function(e){this.parent.y||(this.parent.y=d3.scale.linear().domain(t(e,1))),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0])},r=function(t){e.bind(this)(t),n.bind(this)(t)},s={configure:function(t){r.bind(this)(t)},render:function(t){var e=this.parent;e.mixins.forEach(function(n){e.features[n].render.bind(e)(e.features[n],t)})}};return s.parent=this,s};d4.lineChart=function(){var e=d4.baseChart({},t);return[{linesSeries:d4.features.lineSeries},{linesSeriesLabels:d4.features.lineSeriesLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){e.mixin(t)}),e}}.call(this),function(){"use strict";var t=function(){var t=function(t){this.parent.x||(this.parent.x=d3.scale.linear().domain(d3.extent(t,function(t){return t[0]}))),this.parent.x.range([0,this.parent.width-this.parent.margin.right-this.parent.margin.left]).clamp(!0).nice()},e=function(t){this.parent.y||(this.parent.yRoundBands=this.parent.yRoundBands||.3,this.parent.y=d3.scale.ordinal().domain(t.map(function(t){return t[1]})).rangeRoundBands([0,this.parent.height-this.parent.margin.top-this.parent.margin.bottom],this.parent.yRoundBands))},n=function(n){t.bind(this)(n),e.bind(this)(n)},r={configure:function(t){n.bind(this)(t)},render:function(t){var e=this.parent;e.mixins.forEach(function(n){e.features[n].render.bind(e)(e.features[n],t)})}};return r.parent=this,r};d4.rowChart=function(){var e=d4.baseChart({},t);return[{bars:d4.features.rowSeries},{rowLabels:d4.features.rowLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){e.mixin(t)}),e}}.call(this),function(){"use strict";var t=function(){var t=function(t){this.parent.x||d3.scale.linear().domain(t.map(function(t){return t[0]})).nice().clamp(!0),this.parent.x.range([0,this.parent.width-this.parent.margin.left-this.parent.margin.right])},e=function(t){this.parent.y||(this.parent.y=d3.scale.linear().domain(t.map(function(t){return t[1]})).nice().clamp(!0)),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0])},n=function(t){this.parent.z||(this.parent.z=d3.scale.linear().domain(t.map(function(t){return t[2]})).nice().clamp(!0));var e=this.parent.height-this.parent.margin.top-this.parent.margin.bottom;this.parent.z.range([e/t.length,e/(5*t.length)])},r=function(r){t.bind(this)(r),e.bind(this)(r),n.bind(this)(r)},s={configure:function(t){r.bind(this)(t)},render:function(t){var e=this.parent;e.mixins.forEach(function(n){e.features[n].render.bind(e)(e.features[n],t)})}};return s.parent=this,s};d4.scatterPlot=function(){var e=d4.baseChart({accessors:["z"]},t);return[{scatterSeries:d4.features.scatterSeries},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){e.mixin(t)}),e}}.call(this),function(){"use strict";var t=function(){return"x"},e=function(){return"y"},n=function(){var t=function(t){this.parent.x||(this.parent.xRoundBands=this.parent.xRoundBands||.3,this.parent.x=d3.scale.ordinal().domain(t.map(function(t){return t.x})).rangeRoundBands([0,this.parent.width-this.parent.margin.left-this.parent.margin.right],this.parent.xRoundBands))},e=function(t){this.parent.y||(this.parent.y=d3.scale.linear().domain(d3.extent(t,function(t){return t[1]}))),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0]).clamp(!0).nice()},n=function(n){t.bind(this)(n),e.bind(this)(n)},r={configure:function(t){n.bind(this)(t)},render:function(t){var e=this.parent;e.mixins.forEach(function(n){e.features[n].render.bind(e)(e.features[n],t)})}};return r.parent=this,r};d4.stackedColumnChart=function(){var r=d4.baseChart({accessors:["xKey","yKey"],xKey:t,yKey:e},n);return[{bars:d4.features.stackedColumnSeries},{columnLabels:d4.features.stackedColumnLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){r.mixin(t)}),r}}.call(this),function(){"use strict";var t=function(){return"x"},e=function(){return"y"},n=function(){var t=function(t){this.parent.x||(this.parent.xRoundBands=this.parent.xRoundBands||.3,this.parent.x=d3.scale.ordinal().domain(t.map(function(t){return t.x})).rangeRoundBands([0,this.parent.width-this.parent.margin.left-this.parent.margin.right],this.parent.xRoundBands))},e=function(t){this.parent.y||(this.parent.y=d3.scale.linear().domain(d3.extent(t,function(t){return t[1]})),this.parent.y.range([this.parent.height-this.parent.margin.top-this.parent.margin.bottom,0]).clamp(!0).nice())},n=function(n){t.bind(this)(n),e.bind(this)(n)},r={configure:function(t){n.bind(this)(t)},render:function(t){var e=this.parent;e.mixins.forEach(function(n){e.features[n].render.bind(e)(e.features[n],t)})}};return r.parent=this,r};d4.waterfallChart=function(){var r=d4.baseChart({accessors:["xKey","yKey"],xKey:t,yKey:e},n);return[{bars:d4.features.stackedColumnSeries},{connectors:d4.features.waterfallConnectors},{columnLabels:d4.features.stackedColumnLabels},{xAxis:d4.features.xAxis},{yAxis:d4.features.yAxis}].forEach(function(t){r.mixin(t)}),r}}.call(this),function(){"use strict";d4.features.arrow=function(t){return{accessors:{tipSize:function(){return 6},x1:function(){return this.x(0)},x2:function(){return this.x(this.width-this.margin.left-this.margin.right)},y1:function(){return this.y(0)},y2:function(){return this.y(this.height-this.margin.top-this.margin.bottom)}},render:function(e){var n=this.svg.select("defs");n.append("marker").attr("id",t+"-end").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",e.accessors.tipSize.bind(this)).attr("markerHeight",e.accessors.tipSize.bind(this)).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),n.append("marker").attr("id",t+"-start").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",-e.accessors.tipSize.bind(this)()).attr("markerHeight",e.accessors.tipSize.bind(this)).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).append("line").attr("class","line").attr("x1",e.accessors.x1.bind(this)).attr("x2",e.accessors.x2.bind(this)).attr("y1",e.accessors.y1.bind(this)).attr("y2",e.accessors.y2.bind(this)).attr("marker-end","url(#"+t+"-end)");return r}}}}.call(this),function(){"use strict";d4.features.columnLabels=function(t){return{accessors:{x:function(t){return this.x(t[0])+this.x.rangeBand()/2},y:function(t){return 0>t[1]?this.y(t[1])+10:this.y(t[1])-5},text:function(t){return d3.format("").call(this,t[1])}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(n);return r.enter().append("text"),r.exit().remove(),r.attr("class","column-label").text(e.accessors.text.bind(this)).attr("x",e.accessors.x.bind(this)).attr("y",e.accessors.y.bind(this)),r}}}}.call(this),function(){"use strict";d4.features.columnSeries=function(t){var e=function(t){return t instanceof Array},n=function(t){return e(t)&&e(t[0])&&e(t[0][1])?t:[t]};return{accessors:{x:function(t){return this.x(t[0])},y:function(t){return 0>t[1]?this.y(0):this.y(t[1])},width:function(){return this.x.rangeBand()},height:function(t){return Math.abs(this.y(t[1])-this.y(0))},classes:function(t,e){return 0>t[1]?"bar negative fill series"+e:"bar positive fill series"+e}},render:function(e,r){n(r),this.featuresGroup.append("g").attr("class",t);var s=this.svg.select("."+t).selectAll("."+t+"Series").data(r);s.enter().append("g"),s.exit().remove(),s.attr("class",function(t,e){return"series"+e});var i=s.selectAll("rect").data(function(t){return[t]});return i.enter().append("rect"),i.exit().remove(),i.attr("class",e.accessors.classes.bind(this)).attr("x",e.accessors.x.bind(this)).attr("y",e.accessors.y.bind(this)).attr("width",e.accessors.width.bind(this)).attr("height",e.accessors.height.bind(this)),i}}}}.call(this),function(){"use strict";d4.features.grid=function(t){return{accessors:{formatXAxis:function(t){return t.orient("bottom")},formatYAxis:function(t){return t.orient("left")}},render:function(e){var n=d3.svg.axis().scale(this.x),r=d3.svg.axis().scale(this.y),s=e.accessors.formatXAxis.bind(this)(n),i=e.accessors.formatYAxis.bind(this)(r);this.featuresGroup.append("g").attr("class","grid border "+t).attr("transform","translate(0,0)").append("rect").attr("x",0).attr("y",0).attr("width",this.width-this.margin.left-this.margin.right).attr("height",this.height-this.margin.top-this.margin.bottom),this.featuresGroup.append("g").attr("class","x grid "+t).attr("transform","translate(0,"+(this.height-this.margin.top-this.margin.bottom)+")").call(s.tickSize(-(this.height-this.margin.top-this.margin.bottom),0,0).tickFormat("")),this.featuresGroup.append("g").attr("class","y grid "+t).attr("transform","translate(0,0)").call(i.tickSize(-(this.width-this.margin.left-this.margin.right),0,0).tickFormat(""))}}}}.call(this),function(){"use strict";d4.features.lineSeriesLabels=function(t){return{accessors:{x:function(t){return this.x(t.values[t.values.length-1][0])},y:function(t){return this.y(t.values[t.values.length-1][1])},text:function(t){return t.name},classes:function(t,e){return"stroke series"+e}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(n);return r.enter().append("text"),r.exit().remove(),r.attr("class","lineSeriesLabel").text(e.accessors.text.bind(this)).attr("x",e.accessors.x.bind(this)).attr("y",e.accessors.y.bind(this)).attr("class",e.accessors.classes.bind(this)),r}}}}.call(this),function(){"use strict";d4.features.lineSeries=function(t){return{accessors:{x:function(t){return this.x(t[0])},y:function(t){return this.y(t[1])},classes:function(t,e){return"line stroke series"+e}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var r=d3.svg.line().x(e.accessors.x.bind(this)).y(e.accessors.y.bind(this)),s=this.svg.select("."+t).selectAll("."+t).data(n).enter().append("path").attr("d",function(t){return r(t.values)}).attr("class",e.accessors.classes.bind(this));return s}}}}.call(this),function(){"use strict";d4.features.referenceLine=function(t){return{accessors:{x1:function(){return this.x(0)},x2:function(){return this.x(this.width-this.margin.left-this.margin.right)},y1:function(){return this.y(0)},y2:function(){return this.y(this.height)}},render:function(e){this.featuresGroup.append("g").attr("class",t);var n=this.svg.select("."+t).append("line").attr("class","line").attr("x1",e.accessors.x1.bind(this)).attr("x2",e.accessors.x2.bind(this)).attr("y1",e.accessors.y1.bind(this)).attr("y2",e.accessors.y2.bind(this));return n}}}}.call(this),function(){"use strict";d4.features.rowLabels=function(t){return{accessors:{x:function(t){return this.x(Math.min(0,t[0]))+Math.abs(this.x(t[0])-this.x(0))+5},y:function(t){return this.y(t[1])+this.y.rangeBand()/2},text:function(t){return d3.format("").call(this,t[0])}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(n);return r.enter().append("text"),r.exit().remove(),r.attr("class","column-label").text(e.accessors.text.bind(this)).attr("x",e.accessors.x.bind(this)).attr("y",e.accessors.y.bind(this)),r}}}}.call(this),function(){"use strict";d4.features.rowSeries=function(t){return{accessors:{x:function(t){return this.x(Math.min(0,t[0]))},y:function(t){return this.y(t[1])},height:function(){return this.y.rangeBand()},width:function(t){return Math.abs(this.x(t[0])-this.x(0))},classes:function(t,e){return 0>t[0]?"bar negative fill series"+e:"bar positive fill series"+e}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(n);return r.enter().append("rect"),r.exit().remove(),r.attr("class",e.accessors.classes.bind(this)).attr("x",e.accessors.x.bind(this)).attr("y",e.accessors.y.bind(this)).attr("width",e.accessors.width.bind(this)).attr("height",e.accessors.height.bind(this)),this.featuresGroup.append("g").attr("class","x zero "+t).append("line").attr("class","line").attr("x1",this.x(0)).attr("x2",this.x(0)).attr("y1",0).attr("y2",this.height),r}}}}.call(this),function(){"use strict";d4.features.scatterSeries=function(t){return{accessors:{cx:function(t){return this.x(t.values[0])},cy:function(t){return this.y(t.values[1])},r:function(t){return this.z(t.values[2])},classes:function(t,e){return"dot series"+e+" fill"}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(n);return r.enter().append("circle"),r.attr("class",e.accessors.classes.bind(this)).attr("r",e.accessors.r.bind(this)).attr("cx",e.accessors.cx.bind(this)).attr("cy",e.accessors.cy.bind(this)),r}}}}.call(this),function(){"use strict";d4.features.stackedColumnLabels=function(t){var e=function(t){return t>0?"positive":"negative"};return{accessors:{x:function(t){return this.x(t[this.xKey()])+this.x.rangeBand()/2},y:function(t){var e=Math.abs(this.y(t.y0)-this.y(t.y0+t.y))/2,n=t.y0+t.y;return 0>n?this.y(t.y0)-e:this.y(n)+e},text:function(t){return d3.format("").call(this,t.value)}},render:function(n,r){this.featuresGroup.append("g").attr("class",t);var s=this.svg.select("."+t).selectAll(".group").data(r).enter().append("g").attr("class",function(t,n){return"series"+n+" "+e(t.y)+" "+this.xKey()}.bind(this)),i=s.selectAll("text").data(function(t){return t.values}.bind(this));i.exit().remove(),i.enter().append("text").text(n.accessors.text.bind(this)).attr("y",n.accessors.y.bind(this)).attr("x",n.accessors.x.bind(this))}}}}.call(this),function(){"use strict";d4.features.stackedColumnSeries=function(t){var e=function(t){return t>0?"positive":"negative"};return{accessors:{x:function(t){return this.x(t[this.xKey()])},y:function(t){var e=t.y0+t.y;return 0>e?this.y(t.y0):this.y(e)},width:function(){return this.x.rangeBand()},height:function(t){return Math.abs(this.y(t.y0)-this.y(t.y0+t.y))},classes:function(t,n){return"bar fill item"+n+" "+e(t.y)+" "+t[this.yKey()]}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll(".group").data(n).enter().append("g").attr("class",function(t,e){return"series"+e+" "+this.xKey()}.bind(this));r.selectAll("rect").data(function(t){return t.values}.bind(this)).enter().append("rect").attr("class",e.accessors.classes.bind(this)).attr("x",e.accessors.x.bind(this)).attr("y",e.accessors.y.bind(this)).attr("width",e.accessors.width.bind(this)).attr("height",e.accessors.height.bind(this))}}}}.call(this),function(){"use strict";d4.features.trendLine=function(t){return{accessors:{x1:function(){return this.x(0)},x2:function(){return this.x(this.width)},y1:function(){return this.y(0)},y2:function(){return this.y(this.height)},text:function(t){return d3.format("").call(this,t[1])},textX:function(){return this.x(this.width)},textY:function(){return this.x(this.height)}},render:function(e){var n=this.svg.select("defs");n.append("marker").attr("id",t+"-start").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",-6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).append("line").attr("class","line").attr("x1",e.accessors.x1.bind(this)).attr("x2",e.accessors.x2.bind(this)).attr("y1",e.accessors.y1.bind(this)).attr("y2",e.accessors.y2.bind(this)).attr("marker-end","url(#"+t+"-start)");return this.svg.select("."+t).append("text").attr("class","trendLine-label").text(e.accessors.text.bind(this)).attr("x",e.accessors.textX.bind(this)).attr("y",e.accessors.textY.bind(this)),r}}}}.call(this),function(){"use strict";d4.features.waterfallConnectors=function(t){return{accessors:{x1:function(t){var e=0,n=t.y0+t.y-Math.max(0,t.y);return t.y>0&&(e=Math.abs(this.x(t.y0)-this.x(t.y0+t.y))),this.x(n)+e},y1:function(t){return this.y(t[this.yKey()])},span:function(){return this.y.rangeBand()},classes:function(t,e){return"series"+e}},render:function(e,n){this.featuresGroup.append("g").attr("class",t);var r=this.svg.select("."+t).selectAll("."+t).data(function(t){return t.map(function(t){return t.values[0]})}.bind(this));return r.enter().append("line"),r.exit().remove(),r.attr("class",e.accessors.classes.bind(this)).attr("x1",function(t,r){return 0===r?0:e.accessors.x1.bind(this)(n[r-1].values[0])}.bind(this)).attr("y1",function(t,r){return 0===r?0:e.accessors.y1.bind(this)(n[r-1].values[0])}.bind(this)).attr("x2",function(t,r){return 0===r?0:e.accessors.x1.bind(this)(n[r-1].values[0])}.bind(this)).attr("y2",function(t,n){return 0===n?0:e.accessors.y1.bind(this)(t)+e.accessors.span.bind(this)(t)}.bind(this)),r}}}}.call(this),function(){"use strict";d4.features.xAxis=function(t){return{accessors:{format:function(t){return t.orient("bottom").tickSize(0)}},render:function(e){var n=d3.svg.axis().scale(this.x),r=e.accessors.format.bind(this)(n);this.featuresGroup.append("g").attr("class","x axis "+t).attr("transform","translate(0,"+(this.height-this.margin.top-this.margin.bottom)+")").call(r)}}}}.call(this),function(){"use strict";d4.features.yAxis=function(t){var e=function(t,e){t.each(function(){var t,n=d3.select(this),r=n.text().split(/\s+/).reverse(),s=[],i=0,a=1.1,c=n.attr("x"),u=n.attr("y"),o=parseFloat(n.attr("dy")),h=n.text(null).append("tspan").attr("x",c).attr("y",u).attr("dy",o+"em");for(t=r.pop();t;)s.push(t),h.text(s.join(" ")),h.node().getComputedTextLength()>e-Math.abs(c)&&(s.pop(),h.text(s.join(" ")),s=[t],h=n.append("tspan").attr("x",c).attr("y",u).attr("dy",++i*a+o+"em").text(t)),t=r.pop()})};return{accessors:{format:function(t){return t.orient("left").tickSize(0)}},render:function(n){var r=d3.svg.axis().scale(this.y),s=n.accessors.format.bind(this)(r);this.featuresGroup.append("g").attr("class","y axis "+t).attr("transform","translate(0,0)").call(s).selectAll(".tick text").call(e,this.margin.left)}}}}.call(this),function(){"use strict";d4.parsers.nestedStack=function(){var t={x:{key:"x",values:[]},y:{key:"y",values:[]},value:{key:"value",values:[]},data:[]},e=function(e,n){["x","y","value"].forEach(function(r){var s=n.map(function(t){return t[e[r].key]});t[r].values=d3.set(s).values()})},n=function(t,e,n){var r=d3.nest().key(function(e){return e[t]});return r.entries(n)},r=function(e,n){var r={},s=d3.layout.stack().values(function(t){return t.values}).x(function(t){return t[e]}).y(function(e){return+e[t.value.key]}).out(function(t,n,s){t.y=s,t.y>=0?(t.y0=r[t[e]+"Pos"]=r[t[e]+"Pos"]||0,r[t[e]+"Pos"]+=s):(t.y0=r[t[e]+"Neg"]=r[t[e]+"Neg"]||0,r[t[e]+"Neg"]-=Math.abs(s))});s(n.reverse())},s=function(e,n){t[e].key=n()},i=function(s){return s&&d4.extend(t.data,s),e(t,t.data),t.data=n(t.y.key,t.value.key,t.data),r(t.x.key,t.data),t};return i.x=function(e){return s.bind(t)("x",e),i},i.y=function(e){return s.bind(t)("y",e),i},i.value=function(e){return s.bind(t)("value",e),i},i}}.call(this),function(){"use strict";d4.parsers.waterfall=function(){var t={x:{key:"x",values:[]},y:{key:"y",values:[]},value:{key:"value",values:[]},data:[]},e=function(e,n){["x","y","value"].forEach(function(r){var s=n.map(function(t){return t[e[r].key]});t[r].values=d3.set(s).values()})},n=function(t,e,n){var r=d3.nest().key(function(e){return e[t]});return r.entries(n)},r=function(e,n){var r=0,s=function(t){return isNaN(t)?0:t},i=d3.layout.stack().values(function(t){return t.values}).x(function(t){return t[e]}).y(function(e){return+e[t.value.key]}).out(function(e,n,i){isNaN(i)?(isNaN(n)&&(n=r),e.y0=0,e.y=n,e[t.value.key]=n,r=n):(isNaN(n)?(e.y0=r,r+=i):e.y0=n,e.y=i,e[t.value.key]=s(e[t.value.key]))});i(n)},s=function(e,n){t[e].key=n()},i=function(s){return s&&d4.extend(t.data,s),e(t,t.data),t.data=n(t.y.key,t.value.key,t.data),r(t.x.key,t.data),t};return i.x=function(e){return s.bind(t)("x",e),i},i.y=function(e){return s.bind(t)("y",e),i},i.value=function(e){return s.bind(t)("value",e),i},i}}.call(this);